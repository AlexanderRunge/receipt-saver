<ion-header>
  <ion-toolbar>
    <ion-title>Receipts</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar placeholder="Search receipts..." (ionInput)="onSearchChange($event)" [debounce]="300"/>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content/>
  </ion-refresher>

  <!-- Summary Card -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Summary</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>Total Receipts: {{ filteredReceipts.length }}</p>
      <!--<p>Total Spending: {{ getTotalSpending() }}</p>-->
    </ion-card-content>
  </ion-card>

  @if (filteredReceipts.length === 0) {
    <div class="empty-state">
      <ion-icon name="receipt-outline" size="large"/>
      <h2>No receipts yet</h2>
      <p>Tap the + button to add your first receipt</p>
    </div>
  } @else {
    @for (receipt of filteredReceipts; track receipt.id) {
      <ion-card (click)="viewReceipt(receipt)" [button]="true">
        <ion-card-header>
          <div class="card-header-content">
            <div class="header-text">
              <ion-card-title>
                {{ receipt.storeName || 'Unknown Store' }}
              </ion-card-title>
            </div>
            <div>
              <ion-button fill="clear" color="danger" (click)="deleteReceipt(receipt, $event)">
                <ion-icon slot="icon-only" name="trash-outline"/>
              </ion-button>
            </div>
          </div>
        </ion-card-header>

        <ion-card-content>
          <div class="receipt-content">
            @if (receipt.photo) {
              <ion-thumbnail>
                <img [src]="receipt.photo.webviewPath" alt="Receipt"/>
              </ion-thumbnail>
            }
          </div>
        </ion-card-content>
      </ion-card>
    }
  }

  <!-- FAB Button -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="openNewReceipt()">
      <ion-icon name="add-outline"/>
    </ion-fab-button>
  </ion-fab>
</ion-content>
